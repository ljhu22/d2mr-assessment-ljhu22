---
title: 'Level 2 Data Cleaning: Clean the midwest Dataset'
---

# Objective

The objective of this assignment is to practice cleaning and transforming a messy dataset using tidyverse functions. You will use skills like renaming and reordering columns, sorting rows, changing data types, mutating data, and using the stringr and forcats packages.

This is the Level 2 Data Cleaning assignment. You may additionally or alternatively complete the [Level 1 Data Cleaning assignment](https://github.com/nrdowling/d2mr-assessment/tree/main/01_data-cleaning/01_cleaning-level-1), in which you will work with a simple dataset and focus on basic data cleaning tasks. The Level 1 assignment has more direct instruction and is recommended for those who are new to data cleaning.

In this Level 2 Cleaning assignment, you will work with a more complex dataset and perform additional cleaning tasks with less direct instruction. The Level 2 assignment has more opportunities to demonstrating meeting course standards than this Level 1 assignment and is recommended for those who are already comfortable with the tasks in this assignment.

# Instructions

1. If you have not already done so, pull the latest changes from the `d2mr-assessment` repository to ensure you have the most up-to-date version of the assignment files. Confirm you are working in your fork of the repository.
2. Open `cleaning-level-2.qmd` in RStudio and follow the instructions in the Setup section below to load and inspect the (original) `midwest` dataset. 
    - **Important:** Unlike Level 1, you will not be provided with a goal dataset to match. Instead, you will evaluate what cleaning tasks are necessary or useful *in principle*. You can reference the original `midwest` dataset, but ultimately you will need to decide what the "clean" version of the dataset should look like.
3. Follow the guideline to identify and perform cleaning tasks on the `messy-midwest.csv` dataset.
4. At some points in this document you may come across questions or non-coding exercises. Answer these questions in the text of this .qmd document, immediately below the question.
5. *Optional:* Continue to follow the instructions in the assignment script to clean the dataset above and beyond matching the original. 

# Setup

Run these chunks as written. Do not make changes to code except where noted if necessary.

## Loading libraries and set seed

```{r}
#| label: setup
library(tidyverse)
set.seed(1234)
```


## Read in and inspect messy data

Read in and inspect the messy dataset `messy-midwest.csv`.

```{r}

#| label: read-messy-data

### LEAVE THIS CHUNK AS-IS ###

# You *might* need to edit the filepath, but don't change anything else!

# Read in messy-midwest.csv
messy.midwest <- read_csv(
  ########################################
  "messy-midwest.csv", ## <-- THIS IS THE ONLY THING IN THIS CHUNK YOU CAN CHANGE IF NECESSARY
  ########################################
  trim_ws = FALSE, name_repair = "minimal", col_types = cols(.default = col_character()))

# Inspect the structure and contents of the messy midwest dataset with head(), glimpse(), str(), and/or View()
head(messy.midwest)
glimpse(messy.midwest)
str(messy.midwest)
View(messy.midwest)

```

## Inspect the original midwest dataset

```{r}
#| label: inspect-original-data

### LEAVE THIS CHUNK AS-IS ###

# Load the original midwest dataset
data(midwest)

# View the documentation for the midwest dataset
?midwest

# Inspect the structure and contents original midwest dataset with head(), glimpse(), str(), and/or View()
head(midwest)
glimpse(midwest)
str(midwest)
View(midwest)

```

QUESTIONS:

1. What are the differences between the messy dataset and the original midwest dataset?
<!-- answer below -->
1) Column Order: The columns in the messy dataset are arranged differently from the original dataset.
2) Column Name Discrepancies: There are several column name issues in the messy dataset, such as "C0unty Name" instead of "County Name" and "Total P0pulation" instead of "Total Population". Some columns are also missing from one dataset but present in the other.
3) Data Types: In the messy dataset, most of the columns are stored as text, while in the original dataset, many of these should be numeric.
4) Inconsistent Values: The messy dataset has issues with inconsistent values, like misspelled county names, extra spaces, and capitalization inconsistencies.
5) Number Formatting: There are inconsistencies in the way numbers are formatted, such as irregular decimal places and potential issues with commas versus periods.
6) Rounding Differences: The numbers in the messy dataset are not rounded consistently, unlike in the original dataset where the rounding is more standardized.


2. What are the biggest issues you need to address in cleaning?
<!-- answer below -->
1) Rename columns: Several column names have spelling errors, incorrect characters (like "0" instead of "O"), and mismatched names between the two datasets.
2) Data Type Issues: Many columns that should be numeric are currently stored as text. These need to be converted to the appropriate data types (e.g., population counts and percentages should be numeric) for accurate analysis.
3) Inconsistent and Misspelled Values: Some county names are misspelled or have extra spaces and formatting issues. These need to be corrected to ensure consistency across the dataset.
4) Irregular Number Formatting: Numbers in the dataset are not consistently formatted, with potential issues like commas instead of periods, as well as different decimal places. This should be addressed to maintain uniformity.
5) Rounding Differences: The numbers in the messy dataset have varying decimal places, while the original dataset uses more consistent rounding. Standardizing the number of decimal places is necessary for better data consistency.

3. Are there any differences between the messy dataset and the original dataset that you do not need or want to address in cleaning? If so, why (not)?
<!-- answer below -->!
1) Additional Columns in the Messy Dataset: The messy dataset contains a few additional columns, such as "Population per Sq Mile" and "Population Over 18." These extra columns do not need to be removed, because they may contain useful data.
2) The "Category" Column: Both datasets have a "category" column, but this column might not need much adjustment. If the values in this column are consistent across both datasets, no action is required.


4. Are there additional cleaning tasks you would like to perform beyond matching the original dataset? If so, what are they and why do you think they are important?
<!-- answer below -->





# Cleaning

You may approach cleaning the dataset however you like based on how you identified problems above and how you think they should be prioritized.

If you're not sure where to start, you can organize your cleaning into the following categories. **You do not need to follow this structure.** Feel free to delete these sections, rearrange them, or add new ones as needed. (FYI: When I cleaned this myself I loosely followed this structure, but there were some parts of my approach that could not have worked in this order.)

You can additionally/alternatively construct your cleaning in a single pipeline in the last chunk.

## Selecting, renaming, and reordering columns

```{r}
#load the dplyr package
library(dplyr)

# Check column names in the messy dataset
colnames(messy.midwest)


# 1. Selecting relevant columns
selected_columns <- c("C0unty Name", "State", "Area (sq miles)", "Total P0pulation", 
                      "Population Density", "Percentage Asian", "Population Over 18", 
                      "Percentage College", "Percentage Below Poverty")

# 2. Renaming columns to match the original dataset
messy_cleaned <- messy.midwest %>%
  rename(
    county = `C0unty Name`,
    state = State,
    area = `Area (sq miles)`,
    poptotal = `Total P0pulation`,
    popdensity = `Population Density`,
    percasian = `Percentage Asian`,
    popadults = `Population Over 18`,
    percollege = `Percentage College`,
    percbelowpoverty = `Percentage Below Poverty`
  )

# View the structure of the cleaned dataset
str(messy_cleaned)

# 3. Reordering columns to match the structure
messy_cleaned <- messy_cleaned %>%
  select(PID, county, state, area, poptotal, popdensity, popwhite, popblack, popamerindian, popasian, popother, percamerindan, percasian, percother, popadults, perchsd, percollege, percprof, poppovertyknown, percpovertyknown, percbelowpoverty, percchildbelowpovert, percadultpoverty, percelderlypoverty, inmetro, category)

# View the cleaned dataset
head(messy_cleaned)

```

## Changing data types

```{r}
#Check the data type of each variable before changing the data types
str(messy_cleaned)

# Changing data types
messy_cleaned <- messy_cleaned %>%
  
# Convert numeric columns from character to numeric
 mutate(
    area = as.numeric(area),
    popdensity = as.numeric(popdensity),
    poptotal = as.integer(poptotal),
    popwhite = as.integer(popwhite),
    popblack = as.integer(popblack),
    popamerindian = as.integer(popamerindian),
    popasian = as.integer(popasian),
    popother = as.integer(popother),
    percamerindan = as.numeric(percamerindan),
    percother = as.numeric(percother),
    popadults = as.integer(popadults),
    perchsd = as.numeric(perchsd),
    percprof = as.numeric(percprof),
    poppovertyknown = as.integer(poppovertyknown),
    percpovertyknown = as.numeric(percpovertyknown),
    percchildbelowpovert = as.numeric(percchildbelowpovert),
  )

# Check the structure of the data after changing the data types
str(messy_cleaned)

```


## Mutating data

```{r}
#| label: Log transform specific variable
# Log transform the population total
messy_cleaned <- messy_cleaned %>%
  mutate(
    log_popdensity = log(popdensity)
  )

# View the new log-transformed column
head(messy_cleaned)

#| label: Create a new column
# Create a new variable 'poverty_status' based on 'percbelowpoverty'
messy_cleaned <- messy_cleaned %>%
  mutate(
    poverty_status = ifelse(percbelowpoverty > 20, "High Poverty", "Low Poverty")
  )

# View the new column
head(messy_cleaned)

#| label: Categorize a variable into levels
# Categorize population density into different levels
messy_cleaned <- messy_cleaned %>%
  mutate(
    pop_density_category = case_when(
      popdensity < 500 ~ "Low",
      popdensity >= 500 & popdensity <= 2000 ~ "Medium",
      popdensity > 2000 ~ "High",
      TRUE ~ "Unknown"
    )
  )

# View the new column
head(messy_cleaned)

```


## Using stringr and forcats

```{r}
#Load the stringr package
library(stringr)

#| USING stringr
#| label: Trimming Leading and Trailing Whitespace from the 'county' Column
# Clean up by removing any extra spaces at the start or end of the county names
messy_cleaned <- messy_cleaned %>%
  mutate(county = str_trim(county))

# View the cleaned column
head(messy_cleaned$county)

#| label: Replacing Text in the 'county' Column
# Replace any instances of "County" with an empty string
messy_cleaned <- messy_cleaned %>%
  mutate(county = str_replace(county, "County", ""))

# View the modified 'county' column
head(messy_cleaned$county)

#| label:Converting All Text to Uppercase
# Convert the 'county' column to uppercase
messy_cleaned <- messy_cleaned %>%
  mutate(county = str_to_upper(county))

# View the cleaned 'county' column
head(messy_cleaned$county)


#| USING forcats
#| label: Reordering the Factor Levels of the 'category' Column
# Rearrange categories by their frequency of appearance
messy_cleaned <- messy_cleaned %>%
  mutate(category = fct_infreq(category))

# View the reordered 'category' column
head(messy_cleaned$category)

#| label: Reordering the Factor Levels of the 'category' Column
# Set a custom order for the categories
messy_cleaned <- messy_cleaned %>%
  mutate(category = fct_relevel(category, "AAR", "AAU", "ALU", "AHR"))

# View the reordered 'category' column with custom order
head(messy_cleaned$category)

```


## Other cleaning tasks

```{r}
#| label: Cleaning Missing Data
#Remove rows with missing values
messy_cleaned <- messy_cleaned %>%
  drop_na()

# View the cleaned dataset
head(messy_cleaned)

#| label:Removing Duplicates
# Remove duplicate rows on all columns
messy_cleaned <- messy_cleaned %>%
  distinct()

# View the cleaned dataset
head(messy_cleaned)

#| label:Removing Outliers
#Remove outliers of the Population Density
# Remove rows where 'popdensity' is greater than 10000
messy_cleaned <- messy_cleaned %>%
  filter(popdensity < 10000)

# Remove rows where 'popdensity' is smaller than 400
messy_cleaned <- messy_cleaned %>%
  filter(popdensity > 400)

# View the cleaned dataset
head(messy_cleaned)

#| Formatting and Standardizing Columns
#capitalizing the first Letter of each word in a country column
messy_cleaned <- messy_cleaned %>%
  mutate(county = str_to_title(county))

# View the updated 'county' column
head(messy_cleaned$county)


```




## All cleaning in a single pipeline
```{r}

#| label: one-pipeline

library(dplyr)
library(stringr)

# Perform all cleaning tasks in a single pipeline
messy_cleaned <- messy_cleaned %>%
  # Remove rows with missing values
  drop_na() %>%
  
  # Remove duplicate rows
  distinct() %>%
  
  # Remove outliers in 'popdensity' (greater than 10000 and less than 400)
  filter(popdensity < 10000, popdensity > 400) %>%
  
  # Capitalize the first letter of each word in 'county' column
  mutate(county = str_to_title(county))

# View the cleaned dataset
head(messy_cleaned)

```



# Reflection

QUESTIONS:

1. Is your dataset identical to `midwest`? If not, what is different? (Remember the functions `all.equal()` and `diff_data()` can help here.)

<!-- answer below -->

2. Did you make any choices to clean the data that resulted in the dataset not matching the original? Why did you make those choices?

<!-- answer below -->

3. Were there any cleaning steps -- whether necessary to recreate the original df or just because you wanted to do them -- that you weren't able to implement? If so, what were they and what more would you need to do/know to implement them? 

<!-- answer below -->


# Unguided cleaning and transformation

*Optional:* If you have the time and interest, continue transforming this dataset as you please. Create new columns based on the existing ones, reformat strings, try your hand at a regex replacement, summarize by groups (factor levels), visualize a simple relationship, or anything else you can think of. To get you started, consider things like:

1. **Exploratory Data Analysis:** Use the cleaned dataset to explore relationships between variables, create visualizations, and generate insights.
2. **Data Transformation:** Create new variables, aggregate data, or reshape the dataset to prepare it for analysis.
3. **Split, Merge, and Reshape:** Split the dataset into multiple datasets or merge it with other datasets using `join` functions to create a new dataset. Use `pivot_longer()` and `pivot_wider()` to reshape the data.
4. **Informativity:** Consider the midwest data and its documentation. Clean/transform the dataframe into a format that is more informative, transparent, or easier to work with. For example, improve column naming conventions, create new (useful) variables, reduce redundancy, or eliminate variables that are not useful or documented.


# Submission & Assessment

To submit:

1. Add an `assessment.md` file to this mini-project's directory:
    1. Check off all objectives you believe you have demonstrated
    2. Indicate which unique objectives you are meeting for the first time (if any)
    3. Complete any relevant open-ended items
2. Push your changes to your centralized assignment repository on GitHub. 
3. Confirm that Dr. Dowling and your section TA are added as collaborators to your repository.
4. Submit your work in your next open mini-project assignment by including the following information in the text box:
    1. The title of the assignment: "Level 2 Data Cleaning: Clean the midwest Dataset"
    2. A link to the **directory** for this assignment in your centralized assignment repo



